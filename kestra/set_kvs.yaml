id: set_gcp_kvs
namespace: ingestion
description: Set GCP configuration values in KV store

tasks:
  - id: set_project_id
    type: io.kestra.plugin.core.kv.Set
    key: GCP_PROJECT_ID
    value: ny-taxi-485717
    namespace: ingestion
    overwrite: true

  - id: set_location
    type: io.kestra.plugin.core.kv.Set
    key: GCP_LOCATION
    value: us-central1
    namespace: ingestion
    overwrite: true

  - id: set_bucket_name
    type: io.kestra.plugin.core.kv.Set
    key: GCP_BUCKET_NAME
    value: ny-taxi-485717-bucket
    namespace: ingestion
    overwrite: true

  - id: set_dataset
    type: io.kestra.plugin.core.kv.Set
    key: GCP_DATASET
    value: ny_taxi_data
    namespace: ingestion
    overwrite: true

  - id: verify_kvs
    type: io.kestra.plugin.core.log.Log
    message: |
      KVs have been set successfully:
      - GCP_PROJECT_ID: {{ kv('GCP_PROJECT_ID') }}
      - GCP_LOCATION: {{ kv('GCP_LOCATION') }}
      - GCP_BUCKET_NAME: {{ kv('GCP_BUCKET_NAME') }}
      - GCP_DATASET: {{ kv('GCP_DATASET') }}
      
      Note: GCP credentials should be referenced directly as:
      serviceAccount: /app/gcp-key.json